notifications:
  email: false

branches:
  only:
    - master
    - develop
    - /^v\d+\.\d+\.\d+/

language: node_js

node_js:
  - '10'
  - '12'

before_install:
# Add `aws` CLI tool.
  - pip install --user awscli

install:
  - yarn install --frozen-lockfile --non-interactive

jobs:
  include:
    - stage: Build Reason
      script:
        - yarn build:re
    - stage: Build TypeScript
      script:
        - yarn check:ts
    - stage: Lint
      script:
        - yarn lint
    - stage: Test
      script:
        - yarn test
    - stage: Build
      script:
        - yarn build
    - stage: documentation
      node_js: '12'
      script:
        - cd docs
        - yarn install --frozen-lockfile
        - yarn run check-ci
        # Build and deploy to staging.
        - yarn run clean
        - yarn run stage:build
        - yarn run stage:deploy
      deploy:
        # Deploy master to production
        - provider: script
          # Build and deploy to production.
          # _Note_: `deploy.script` must be a **single** command string
          script: >-
            yarn run clean &&
            yarn run prod:build &&
            yarn run prod:deploy
          skip_cleanup: true
          on:
            branch: master

env:
  global:
  # **Staging**: surge (`Surge.sh`)
  # TRAVIS_LOGIN
  - secure: h1XSy3xfcYpICxSCyM1ChZ38PTa/s4Og9HoSRKle2Nu756ecSf79FvA6PsPK9kMYs3u7ieV1Nza6vjJfMSUxRVMQn9T8PVkMU0rHHCOk2lBf+rCIeT0gaRz0IVvEDSEvWxq2dMR/nQycUVONnrsINIvhz0ERicsRpvXX3BVORHn40+zSUokAtxFTMZUZJlmEVTT0O8uin0HJFmicdGuIixGbrHZlFpcSJGXBqeFbTV/dTESco/uMiSvP7p1MgKLHTjLmu8J31sOBlp+gqdUzzX2nkOCc9iSrHpRxpA5rUPhUvSli9KQn0u2boPNNr0xw6C3YQHg3p5j6dyM8PvousWMhKglFoFR2IuZMr+oz9lcOg6m5xPrEVTfGaEoKalMTsb3dj9/KaCPmGZM6UMrA5lSbmZojk8lxYFdGGBP6b7itutXmStwqYn6VGhaRMTMjp0mDTZON0b/b/eicYPmP3+WQCk6cHEZGg5jfu3KGXv5C24Z8EnnqHVNYd1aG84incqzepe2DTwjk3OZ0IDM2Zpc3IawBqHmpoAPcYSrO3+0Z9PuxX9vu42vL9eBMJSFL5Psj69hH+oTszp9e8zLDcsVgFdb3vKxYwfeiWewXI/6muiF4Uq2Kb+K57wDAmqGrRHliTGrOTzmijBWz4nIbxucGW7meo6rhkqX/tBw8ghY=
  # TRAVIS_TOKEN
  - secure: ZRCyHaKrjVGDynpaq4qL5WGDnmI/fD68ssCWo3PrSDdryZaE8e60l1SOEY+gW5Ho7GxLpRXkEIz7CExDcezYH8tfVq8NIoU5ApXMWp9/4tFqnXkvcXe5NpJ4N8Urc3aZtagVOMOU7NsHXZGHwoKAvmN/HdY6peSnLt/UFwJnVMK1k3IXHWcziillDpXoVK9Cxk4t39vt13WRJRJ1nvjPFJXr/ELIuYIirDGYkfDBe5sTOQ9PziMtP+MTvAcFm4NCTB1l+m0NGEIl8K9AgDWy81aVqU3w8M4wbbkL2USxHrs4FjI5JEcVOOMhWIR442V10x7nrZ6w4pnic7NVAfr8WUCYkBFMKK34UCZ696/zR7wj7+AHd4PlaSDBW/zckFByoW3nZlDzTxXI20UZebx7eBKS9hTDznPxBE5npJNSm/SPrNLaZN6tmwe53pzIp7caiqr/f26iuEtUzgr1lBpQXBp8TXlyzFz4NAh9+btux7pcnrxxbXrBjetkkvYK5eBM0V1LijEAKFLOBhqY5+c4MTdzx9dQVC6CKO2P6VijJuCtHMX++KR2zlr2LtPSiP4CAg3G/lspO/W+KwLtmJCgQ2kyMQ09r0B6ziD8zKak9JMbyXad+V0H/zWASV9SVROX8rl93Cx9kLuOh0KPCj7lNLs5X03TB5MzHmk6Mb7F9y0=
  # **Production**: AWS IAM (renature-ci) (`tf-formidops-renature-ci` user)
  # AWS_ACCESS_KEY_ID
  - secure: "UL4jNSZHKB2Afih5yrA2A+T1PFiC3F8WbGgP3bztDkWsylRL7wOiUfYWI0Dclo7TSWS1uH8XYHZ7suG5WXjlRFOcS3qPSuFHV6FwyhK20RGdOQhWe1U1ldRriJQT2SWrSfo4ml6xOFWt3QleUMfZ4eMmBmo61pqyOl1PRtEaywhuk+xt4CTTLgsMXh3WA6915lCj9e0k+6M99IEItQjs7WqgpZLgxf+9iXnZtxxFjfvAhsUepBeZlrx0BZnVOktYPxHk55jCWvFkr7Z9qVKhiBwbN1DVSaHyQC8fYH/WhcvpxJiCZyvTJ6xI61zAmn+FrH2GurS0CrjNRxEPK5CVFGPfwUf1YAB4WNt/mVKJnAb8TotRb3dE8pkIESY7COgvVCrsg0SqXSNSbvClPdfPbHqYpSJ/2XzlXsEfyvrCw1Vb3/ky+M585EBrmD8LXVBOw/wFvhaNJ80cr+rgQgx99FLvPuLrtRScEPrG2GVZm1HRdzE1L0KCS3MxXv8zrD5KNz+d9gN/fFf2ul8cmX0m8uU0yFuXXdCrZpCYl0sYX5NXDv+++VZ+sZAyeJplIwMcnKlFi/n8Z/G6ztfCeb6iNAiInQL8TMD3cqJVqkEjtrUtFKGfbBNBCVm2mibacbkF3pVcU2n63RWtWZj+nuG+1v3CF8YrlAI2H1de2f/9rNU="
  # AWS_SECRET_ACCESS_KEY
  - secure: "IkLWCBQL3/49IFNA9JZ6WATwXM9/TLwXCZKYfGZLbHzkZTGV9Ep/LJiTxmyhJSBvS6HuXMdCGcA7a8wpb1WlV/M9Fjn2jAvMNXJJmPbdHM61RMum91b2gvclgihqH0HXD0Ha9Gddnc7CBr9dUYtXEi2A3o5wmoBCgsiwlgPZlqIbfSDgJTDBjKSVg7KU0x1DsDY79SaLjAOAqZqdRe4cLSvSGfZBb8/Qb5imYZRhAoDfzLgUg1eVAxYNkHRqclEIsqjyZPj8/jLcQdOPrfoUef9ZRgE6h0cu5Q7nxwyh1vqrvcP41v/4LfEKMpuhAYltrA0P7PjDLP2C2Xxq2qfhsCqSl9l4n6p6wbVNCXCVJiZmsZAL8dL8DxAFVK6haGzYPotX7grkL/ke2sYVBK734XJI/GUW07lO2ncZAyG2IUDeaEnMt7cq1j6koEG9lO/D99cjuRR2Bjnf/z6ivyy4i3nRHbQm4s5kChPHr+z2R6bnzgIqIMPzKJDSyo6E5j+rxbTo8DEjkh7pA6ReuT16N/3fwiF3Q05AJVrdwNL83AppTIgIk4SwaEPBaUcVIcBoN0b+glXd0Yfux9v1fv8b2xqzEY8ktG3+4o2yLmf+Yq7XuNXNoZ/uNzVxaPtC/taURJjFFuaWvD3huJ0yNs+UnIEO8cZsJ/xcqrMNLYuwCN4="
